import{r as u,c as k,x as j,e as a,h as e,i as g,y as b,z as E,F as A,g as S,t as i,u as r,A as h,f as n}from"./vendor-BomGrhGO.js";import{u as $,s as B}from"./index-Dwd-OiAp.js";import"./supabase-DoogjvA8.js";const q={class:"space-y-8"},H={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},J={class:"lg:col-span-2 space-y-6"},K={class:"card"},Q={class:"space-y-4"},W=["value"],X={key:0,class:"bg-blue-50 p-4 rounded-lg"},Y={class:"text-blue-700"},Z={class:"text-blue-600 text-sm"},ee={class:"card"},te={class:"space-y-4"},oe={key:0,class:"mt-2 bg-white border border-gray-300 rounded-lg shadow-lg max-h-40 overflow-y-auto"},le=["onClick"],se={class:"font-medium"},ae={class:"text-sm text-gray-500"},ne={class:"card"},ie={class:"space-y-4"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re=["value"],ue=["max"],ce=["disabled"],me={class:"space-y-6"},ve={class:"card"},be={key:0,class:"text-center py-8 text-gray-500"},pe={key:1,class:"space-y-3"},fe={class:"flex-1"},xe={class:"font-medium text-sm"},ye={class:"text-xs text-gray-500"},ge={key:0,class:"text-xs text-blue-600"},_e={class:"text-right"},Ce={class:"font-medium text-sm"},we=["onClick"],ke={key:0,class:"card"},he={class:"space-y-3"},Pe={class:"flex justify-between"},Ne={class:"font-medium"},Ve={class:"flex justify-between"},Oe={class:"font-medium"},Ae={class:"border-t pt-3"},Se={class:"flex justify-between text-lg font-bold"},Ie={class:"text-primary-600"},Ee={key:1,class:"card"},Te={class:"space-y-4"},ze={key:0},Ue=["max"],Be=["disabled"],Ge={__name:"PedidosView",setup(Fe){const l=$(),p=u(""),c=u(""),_=u(""),f=u(""),m=u(1),C=u(""),v=u(""),x=u(null),y=u([]),P=u(null),I=k(()=>l.vendedores.find(s=>s.id===p.value)),w=k(()=>l.productos.find(s=>s.id===f.value)),F=k(()=>l.productos.filter(s=>s.stock>0)),T=k(()=>{var s;return p.value&&f.value&&m.value>0&&m.value<=(((s=w.value)==null?void 0:s.stock)||0)}),z=k(()=>l.carrito.length>0&&p.value&&c.value.trim()&&v.value&&(v.value!=="ABONO"||x.value>0&&x.value<=l.totalCarrito)),M=()=>{if(!c.value.trim()){y.value=[],P.value=null;return}y.value=l.clientes.filter(s=>s.nombre.toLowerCase().includes(c.value.toLowerCase())).slice(0,5)},D=s=>{P.value=s,c.value=s.nombre,_.value=s.celular||"",y.value=[]},L=()=>{T.value&&(l.addToCart(w.value,m.value,C.value),f.value="",m.value=1,C.value="",window.showNotification("Producto agregado al carrito"))},G=async()=>{var s;if(z.value)try{let t=(s=P.value)==null?void 0:s.id;if(!t){const d=l.clientes.find(O=>O.nombre.toLowerCase()===c.value.toLowerCase());if(d)t=d.id;else{const{data:O,error:U}=await B.from("clientes").insert([{nombre:c.value.trim(),celular:_.value.trim()}]).select();if(U)throw U;t=O[0].id,await l.loadClientes()}}const V=l.carrito.map(d=>({cliente_id:t,vendedor_id:p.value,producto_id:d.producto.id,cantidad:d.cantidad,nombres_personalizados:d.nombres_personalizados,precio_unitario:l.precioGlobal,total:d.cantidad*l.precioGlobal,fecha:new Date().toISOString(),medio_pago:v.value,monto_abono:v.value==="ABONO"?x.value:null,valor_cancelado:v.value!=="ABONO"?d.cantidad*l.precioGlobal:null})),{error:o}=await B.from("pedidos").insert(V);if(o)throw o;R(),l.clearCart(),await l.loadInitialData(),window.showNotification("Pedido confirmado exitosamente",`Total: ${N(l.totalCarrito)}`)}catch(t){console.error("Error confirmando pedido:",t),window.showError("Error al confirmar pedido",t.message)}},R=()=>{p.value="",c.value="",_.value="",f.value="",m.value=1,C.value="",v.value="",x.value=null,y.value=[],P.value=null},N=s=>typeof s!="number"?"$0":s.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0});return j(f,()=>{w.value&&(m.value=Math.min(m.value,w.value.stock))}),(s,t)=>{var V;return n(),a("div",q,[t[31]||(t[31]=e("div",{class:"text-center"},[e("h2",{class:"text-3xl font-bold text-gray-900 mb-2"},"Realizar Pedido"),e("p",{class:"text-gray-600"},"Selecciona productos y completa la información del pedido")],-1)),e("div",H,[e("div",J,[e("div",K,[t[11]||(t[11]=e("h3",{class:"text-xl font-semibold mb-4"},"👤 Información del Vendedor",-1)),e("div",Q,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Seleccionar Vendedor * ",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),class:"select-field"},[t[8]||(t[8]=e("option",{value:""},"Seleccione un vendedor",-1)),(n(!0),a(A,null,S(r(l).vendedores,o=>(n(),a("option",{key:o.id,value:o.id},i(o.nombre)+" - "+i(o.email),9,W))),128))],512),[[E,p.value]])]),I.value?(n(),a("div",X,[t[10]||(t[10]=e("h4",{class:"font-medium text-blue-900"},"Vendedor Seleccionado:",-1)),e("p",Y,i(I.value.nombre),1),e("p",Z,i(I.value.email),1)])):g("",!0)])]),e("div",ee,[t[14]||(t[14]=e("h3",{class:"text-xl font-semibold mb-4"},"👥 Información del Cliente",-1)),e("div",te,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre del Cliente * ",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>c.value=o),type:"text",placeholder:"Nombre completo del cliente",class:"input-field",onInput:M},null,544),[[h,c.value]]),y.value.length>0?(n(),a("div",oe,[(n(!0),a(A,null,S(y.value,o=>(n(),a("button",{key:o.id,onClick:d=>D(o),class:"w-full text-left px-4 py-2 hover:bg-gray-50 border-b border-gray-100 last:border-b-0"},[e("div",se,i(o.nombre),1),e("div",ae,i(o.celular),1)],8,le))),128))])):g("",!0)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Celular ",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),type:"tel",placeholder:"Número de celular",class:"input-field"},null,512),[[h,_.value]])])])]),e("div",ne,[t[19]||(t[19]=e("h3",{class:"text-xl font-semibold mb-4"},"🛍️ Agregar Productos",-1)),e("div",ie,[e("div",de,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Producto * ",-1)),b(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>f.value=o),class:"select-field"},[t[15]||(t[15]=e("option",{value:""},"Seleccione un producto",-1)),(n(!0),a(A,null,S(F.value,o=>(n(),a("option",{key:o.id,value:o.id},i(o.nombre)+" (Stock: "+i(o.stock)+") ",9,re))),128))],512),[[E,f.value]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Cantidad * ",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>m.value=o),type:"number",min:"1",max:((V=w.value)==null?void 0:V.stock)||1,class:"input-field"},null,8,ue),[[h,m.value,void 0,{number:!0}]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nombres Personalizados (opcional) ",-1)),b(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>C.value=o),placeholder:"Nombres para personalizar las velas...",rows:"3",class:"input-field"},null,512),[[h,C.value]])]),e("button",{onClick:L,disabled:!T.value,class:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed"}," ➕ Agregar al Carrito ",8,ce)])])]),e("div",me,[e("div",ve,[t[21]||(t[21]=e("h3",{class:"text-xl font-semibold mb-4"},"🛒 Carrito de Compras",-1)),r(l).carrito.length===0?(n(),a("div",be,[...t[20]||(t[20]=[e("div",{class:"text-4xl mb-2"},"🛒",-1),e("p",null,"El carrito está vacío",-1)])])):(n(),a("div",pe,[(n(!0),a(A,null,S(r(l).carrito,(o,d)=>(n(),a("div",{key:d,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",fe,[e("h4",xe,i(o.producto.nombre),1),e("p",ye,"Cantidad: "+i(o.cantidad),1),o.nombres_personalizados?(n(),a("p",ge," Personalizado: "+i(o.nombres_personalizados),1)):g("",!0)]),e("div",_e,[e("p",Ce,i(N(o.cantidad*r(l).precioGlobal)),1),e("button",{onClick:O=>r(l).removeFromCart(d),class:"text-red-500 hover:text-red-700 text-xs"}," Eliminar ",8,we)])]))),128))]))]),r(l).carrito.length>0?(n(),a("div",ke,[t[26]||(t[26]=e("h3",{class:"text-xl font-semibold mb-4"},"📊 Resumen del Pedido",-1)),e("div",he,[e("div",Pe,[t[22]||(t[22]=e("span",null,"Total de unidades:",-1)),e("span",Ne,i(r(l).totalUnidadesCarrito),1)]),e("div",Ve,[t[23]||(t[23]=e("span",null,"Precio por unidad:",-1)),e("span",Oe,i(N(r(l).precioGlobal)),1)]),e("div",Ae,[e("div",Se,[t[24]||(t[24]=e("span",null,"Total:",-1)),e("span",Ie,i(N(r(l).totalCarrito)),1)])]),t[25]||(t[25]=e("div",{class:"text-xs text-gray-500 bg-blue-50 p-2 rounded"}," 💡 Tip: Pedidos de 12+ unidades obtienen precio mayorista ",-1))])])):g("",!0),r(l).carrito.length>0?(n(),a("div",Ee,[t[30]||(t[30]=e("h3",{class:"text-xl font-semibold mb-4"},"💳 Información de Pago",-1)),e("div",Te,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Medio de Pago ",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>v.value=o),class:"select-field"},[...t[27]||(t[27]=[e("option",{value:""},"Seleccionar medio de pago",-1),e("option",{value:"EFECTIVO"},"Efectivo",-1),e("option",{value:"TRANSFERENCIA"},"Transferencia",-1),e("option",{value:"ABONO"},"Abono",-1)])],512),[[E,v.value]])]),v.value==="ABONO"?(n(),a("div",ze,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Monto del Abono ",-1)),b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>x.value=o),type:"number",min:"0",max:r(l).totalCarrito,class:"input-field",placeholder:"Monto del abono"},null,8,Ue),[[h,x.value,void 0,{number:!0}]])])):g("",!0),e("button",{onClick:G,disabled:!z.value,class:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed"}," ✅ Confirmar Pedido ",8,Be)])])):g("",!0)])])])}}};export{Ge as default};
